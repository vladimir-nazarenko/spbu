Работает, надо бы потестить с таймингами 